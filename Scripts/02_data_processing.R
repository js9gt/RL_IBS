
## Reading in data

#Set WD to Project folder-- will want to change for future if running somewhere else
setwd("/Users/janeshe/Desktop/RL_IBS")

##Add source file reading in data
source('Scripts/01_read_cohort_data.R')

#Read in excel file
#ibs_dat <- read_excel("ibs_dat.xlsx", skip = 1)


#Read in excel file for 4 additional patients
# dat_4pts <- read_excel("data_4pts.xlsx", 
#                         col_types = c("text", "numeric", "text", 
#                                        "text", "text", "text", "text", "numeric", 
#                                        "text", "numeric", "numeric", "text", 
#                                        "numeric", "numeric", "numeric", 
#                                        "numeric", "numeric", "text", "text", 
#                                        "text", "text", "numeric", "text", 
#                                        "numeric", "numeric", "text", "text", 
#                                        "text", "text", "text", "text", "text", 
#                                        "text", "text", "numeric", "numeric", 
#                                        "numeric", "numeric", "text", "numeric", 
#                                        "numeric", "numeric", "numeric", 
#                                        "numeric", "numeric", "numeric", 
#                                        "numeric", "numeric", "numeric", 
#                                        "numeric", "numeric", "numeric", 
#                                        "text", "text", "numeric", "numeric", 
#                                        "text", "text", "text", "text", "text", 
#                                        "text", "text", "numeric", "text", 
#                                        "numeric"))




 
##### all the data manipulation sections ########


## Create new column called "group"-- these will have the option to be:
# Prescriptions
# Imaging
# Labs
# Large Bowel Description
# Small Bowel Description
# Ileo-cecal Description
# Colonoscopy

cohort$group <- 0

## we know prescription claims have NDC codes-- for anything with an NDC code, rewrite that as the "prescription" group
cohort <- cohort %>%
  ## group the labs
  mutate(group = case_when(
    ## CBC w/ diff
    proc_cde ==  "85025" |
      ## C reactive protein
      proc_cde == "86140" | 
      ## Erythrocyte sedimentation rate
      proc_cde == "85651" | 
      proc_cde == "85652" |
      ## Albumin
      proc_cde == "82040" |
      ## AST
      proc_cde == "84450" |
      ## ALT
      proc_cde == "84460" |
      ## Total protein
      proc_cde == "84155"
    ~ "labs", 
    
    ## group imaging   
    ## CT abdomen w/contrast
    proc_cde == "74170" | 
      proc_cde == "74178" |
      ## CT abdomen & pelvis w/o contrast
      proc_cde == "74176" | 
      ## CT abdomen & pelvis w/ contrast 
      proc_cde == "74177" |
      ## MRI abdomen
      proc_cde == "74183" |
      ## MR enterography
      proc_cde == "74181"|
      proc_cde == "74182" |
      proc_cde == "74183"|
      proc_cde == "72195" |
      proc_cde == "72196"|
      proc_cde == "72197" |
      ## Xray abdomen
      proc_cde == "74018"
    ~ "imaging",
    
    ## group prescriptions (anything that has a non-NA NDC code)
    ndc != "" ~ "prescriptions",
    
    ## group Large Bowel Description
    proc_cde ==  "44140" |
      proc_cde == "44141"| 
      proc_cde == "44143" | 
      proc_cde == "44144"|
      proc_cde == "44145" |
      proc_cde == "44146"|
      proc_cde == "44147" |
      proc_cde == "44150"|
      proc_cde == "44151" |
      proc_cde == "44155"|
      proc_cde == "44156" |
      proc_cde == "44157"|
      proc_cde == "44158" |
      proc_cde == "44204"|
      proc_cde == "44206" |
      proc_cde == "44207"|
      proc_cde == "44208" |
      proc_cde == "44210"|
      proc_cde == "44211" |
      proc_cde == "44212"    
    ~ "large_bowel",
    
    ## group Small Bowel Description
    proc_cde ==  "44120" |
      proc_cde == "44121"| 
      proc_cde == "44125" | 
      proc_cde == "44202"    ~ "small_bowel",
    
    ## group ILEO-CECAL Description
    proc_cde ==  "44160" |
      proc_cde == "44205" 
    ~ "ileocecal",
    ## group colonoscopy
    proc_cde ==  "45378" |
      proc_cde == "45380" 
    ~ "colonoscopy",
    
    ## Small Bowel Enteroscopy
    proc_cde == "44360" ~ "enteroscopy",
    
    ## Enteroscopy via -ostomy
    proc_cde == "44380" |
      proc_cde == "44382" |
      proc_cde == "44388" |
      proc_cde == "44389" |
      proc_cde == "44391"
    ~ "enteroscopy_ostomy",
    
    ## Flex Sigmoidoscopy
    proc_cde == "45330" |
    proc_cde == "45331" |
    proc_cde == "45371" |
    proc_cde == "45378"
    ~ "flex_sigmoidoscopy",
    
    ## Pouchoscopy
    proc_cde == "44385" |
      proc_cde == "44386" 
    ~ "pouchoscopy"))


##### ## Create a new column for drug_name & drug_class
cohort$drug_name <- 0

cohort <- cohort %>%
  
  ############### Aminosalicylates
  mutate(drug_name = case_when(
    ## Sulfasalazine
    ndc == "00013010101"|
      ndc == "00013010111" |
      ndc == "00013010120"|
      ndc == "00013010201" |
      ndc == "00013010220"|
      ndc == "00591079601" |
      ndc == "00591079605"|
      ndc == "00591079610" |
      ndc == "00603580104"|
      ndc == "00603580121" |
      ndc == "00603580128"|
      ndc == "00603580132" |
      ndc == "00603580321"|
      ndc == "00603580325" |
      ndc == "00677048301"|
      ndc == "00677048305" |
      ndc == "00904115240"|
      ndc == "00904115260" |
      ndc == "38779017604"|
      ndc == "38779017605" |
      ndc == "38779017608"|
      ndc == "38779017609" |
      ndc == "43353049553"|
      ndc == "43353049570" |
      ndc == "43353049580"|
      ndc == "49452752301" |
      ndc == "49452752302"|
      ndc == "51552104405" |
      ndc == "51927104500"|
      ndc == "52544079601" |
      ndc == "52544079605"|
      ndc == "53489014701" |
      ndc == "53489014705"|
      ndc == "54569031303" |
      ndc == "54868112301"|
      ndc == "54868113801" |
      ndc == "54868113900"|
      ndc == "55289017640" |
      ndc == "58016007490"|
      ndc == "59762010401" |
      ndc == "59762010402"|
      ndc == "59762500001" |
      ndc == "59762500002"|
      ndc == "62991270403" |
      ndc == "67544094370"|
      ndc == "67544094380" ~ "sulfasalazine", 
    
    ## Mesalamine
    ndc == "00023585318"|
      ndc == "00032192428" |
      ndc == "00032192482"|
      ndc == "00032192824" |
      ndc == "00032192846"|
      ndc == "00037002207" |
      ndc == "00037006603"|
      ndc == "00037006605" |
      ndc == "00093688871"|
      ndc == "00149075202" |
      ndc == "00149075206"|
      ndc == "00149075215" |
      ndc == "00149078301"|
      ndc == "00430075227" |
      ndc == "00430075327"|
      ndc == "00430078327" |
      ndc == "00574725003"|
      ndc == "23490509003" |
      ndc == "38779001204"|
      ndc == "38779001205" |
      ndc == "38779001208"|
      ndc == "43353088479" |
      ndc == "43386051087"|
      ndc == "45802009828" |
      ndc == "45802009851"|
      ndc == "45802092341" |
      ndc == "45802092349"|
      ndc == "49452045001" |
      ndc == "49999096918"|
      ndc == "50532006603" |
      ndc == "50532006605"|
      ndc == "51552030205" |
      ndc == "51927107800"|
      ndc == "54092018980" |
      ndc == "54092018981"|
      ndc == "54092019112" |
      ndc == "54092019180"|
      ndc == "54092047602" |
      ndc == "54092047612"|
      ndc == "54569479300" |
      ndc == "54868251500"|
      ndc == "54868251501" |
      ndc == "54868251502"|
      ndc == "54868251503" |
      ndc == "54868251504"|
      ndc == "54868251505" |
      ndc == "54868519900"|
      ndc == "54868530200" |
      ndc == "54868530201"|
      ndc == "54868531400" |
      ndc == "54868614700"|
      ndc == "54868615000" |
      ndc == "55289083330"|
      ndc == "58914050018" |
      ndc == "58914050056"|
      ndc == "58914050118" |
      ndc == "58914050142"|
      ndc == "58914050156" |
      ndc == "62559042007"|
      ndc == "62991100901" |
      ndc == "62991270501"|
      ndc == "62991270502" |
      ndc == "62991270503"|
      ndc == "63370015035" |
      ndc == "65649010302"|
      ndc == "66336050390" |
      ndc == "66993095077"|
      ndc == "67544054981" |
      ndc == "67544054988"|
      ndc == "67544054989" |
      ndc == "68220002207"|
      ndc == "68220002228" |
      ndc == "68220006603"|
      ndc == "68220006605" |
      ndc == "68220006607"|
      ndc == "68220006628" |
      ndc == "68258912901"|
      ndc == "68382048428" ~ "mesalamine", 
    
    
    ## BALSALAZIDE DISODIUM
    ndc == "50268010211"|
      ndc == "54868485500" |
      ndc == "68682075002"|
      ndc == "00591357035" |
      ndc == "42291015728"|
      ndc == "00054007928" |
      ndc == "65649010150"|
      ndc == "50268010213" |
      ndc == "00378675082"|
      ndc == "68084079932" |
      ndc == "65649010202"|
      ndc == "00054007929" |
      ndc == "65649010102"|
      ndc == "60505257507" ~ "balsalazide_disodium", 
    
    ## OLSALAZINE SODIUM
    ndc == "53014072671"|
      ndc == "50474060001" |
      ndc == "00013010501"|
      ndc == "68220016010" |
      ndc == "50474060025"|
      ndc == "00037686010" |
      ndc == "53014072682" ~ "olsalazine_sodium", 
    
    ############ Antibiotics 
    ## Ciprofloxacin
    ndc == "000693241" |
      ndc == "000693342" |
      ndc == "000694395" |
      ndc == "000694396" |
      ndc == "001432037" |
      ndc == "001439927" |
      ndc == "001439928" |
      ndc == "001439929" |
      ndc == "001725311" |
      ndc == "001725312" |
      ndc == "001725313" |
      ndc == "001790054" |
      ndc == "001790188" |
      ndc == "003781743" |
      ndc == "003781745" |
      ndc == "003787098" |
      ndc == "004094777" |
      ndc == "004094777" |
      ndc == "007813239" |
      ndc == "007813240" |
      ndc == "009046378" |
      ndc == "105440036" |
      ndc == "105440079" |
      ndc == "105440147" |
      ndc == "105440432" |
      ndc == "105440603" |
      ndc == "105440604" |
      ndc == "105440605" |
      ndc == "105440607" |
      ndc == "105440608" |
      ndc == "105440673" |
      ndc == "105440884" |
      ndc == "105440943" |
      ndc == "118190363" |
      ndc == "126340769" |
      ndc == "131070076" |
      ndc == "131070077" |
      ndc == "162520514" |
      ndc == "162520515" |
      ndc == "162520516" |
      ndc == "165710411" |
      ndc == "165710412" |
      ndc == "165710413" |
      ndc == "216950422" |
      ndc == "216950914" |
      ndc == "246580185" |
      ndc == "250210114" |
      ndc == "332610164" |
      ndc == "332610367" |
      ndc == "332610399" |
      ndc == "353560846" |
      ndc == "353560928" |
      ndc == "360000008" |
      ndc == "360000009" |
      ndc == "360000010" |
      ndc == "360000011" |
      ndc == "360000029" |
      ndc == "360000030" |
      ndc == "422910219" |
      ndc == "430630053" |
      ndc == "430630410" |
      ndc == "430630427" |
      ndc == "430630547" |
      ndc == "430630767" |
      ndc == "433530924" |
      ndc == "458650471" |
      ndc == "500900086" |
      ndc == "500900086" |
      ndc == "500900086" |
      ndc == "504190759" |
      ndc == "504190773" |
      ndc == "504190777" |
      ndc == "504190788" |
      ndc == "504190789" |
      ndc == "504360041" |
      ndc == "504360313" |
      ndc == "504360604" |
      ndc == "510790182" |
      ndc == "516550118" |
      ndc == "530020264" |
      ndc == "530020279" |
      ndc == "534010004" |
      ndc == "534010301" |
      ndc == "538080107" |
      ndc == "551110125" |
      ndc == "551110126" |
      ndc == "551110127" |
      ndc == "551110128" |
      ndc == "551540537" |
      ndc == "551540782" |
      ndc == "552890821" |
      ndc == "552890823" |
      ndc == "552890826" |
      ndc == "557000279" |
      ndc == "581180012" |
      ndc == "581180041" |
      ndc == "591150028" |
      ndc == "591150029" |
      ndc == "591150030" |
      ndc == "604290042" |
      ndc == "607600512" |
      ndc == "607600815" |
      ndc == "619190054" |
      ndc == "619190361" |
      ndc == "619190371" |
      ndc == "619190735" |
      ndc == "620340016" |
      ndc == "620370938" |
      ndc == "620370942" |
      ndc == "631870017" |
      ndc == "631870142" |
      ndc == "631870250" |
      ndc == "631870990" |
      ndc == "633040709" |
      ndc == "633040710" |
      ndc == "633040711" |
      ndc == "636290132" |
      ndc == "636290172" |
      ndc == "636290386" |
      ndc == "636290635" |
      ndc == "636290636" |
      ndc == "642050927" |
      ndc == "642050928" |
      ndc == "662670716" |
      ndc == "662670919" |
      ndc == "672960057" |
      ndc == "672960059" |
      ndc == "672960062" |
      ndc == "672960085" |
      ndc == "672960109" |
      ndc == "672960126" |
      ndc == "672960131" |
      ndc == "672960138" |
      ndc == "672960157" |
      ndc == "680710189" |
      ndc == "680710301" |
      ndc == "680710412" |
      ndc == "680710420" |
      ndc == "680710426" |
      ndc == "680710438" |
      ndc == "681800392" |
      ndc == "681800393" |
      ndc == "686450060" |
      ndc == "687880900" |
      ndc == "687880901" |
      ndc == "687880902" |
      ndc == "687880928" |
      ndc == "687880933" |
      ndc == "705180001" |
      ndc == "705180036" |
      ndc == "705180046" |
      ndc == "705180069" |
      ndc == "705180109" |
      ndc == "707860041" |
      ndc == "707860051" |
      ndc == "709340045" |
      ndc == "709340068" |
      ndc == "713350007" |
      ndc == "713350033" |
      ndc == "713350040" |
      ndc == "759210412" |
      ndc == "000260562" |
      ndc == "000260564" |
      ndc == "000693242" |
      ndc == "000747064" |
      ndc == "000783239" |
      ndc == "000783240" |
      ndc == "000851731" |
      ndc == "000851741" |
      ndc == "000851755" |
      ndc == "000851759" |
      ndc == "000851762" |
      ndc == "000851763" |
      ndc == "000851773" |
      ndc == "000851777" |
      ndc == "000851781" |
      ndc == "000851782" |
      ndc == "000930863" |
      ndc == "000930864" |
      ndc == "000930865" |
      ndc == "001432036" |
      ndc == "001432038" |
      ndc == "003380960" |
      ndc == "003383478" |
      ndc == "003383479" |
      ndc == "003781322" |
      ndc == "003781323" |
      ndc == "003781324" |
      ndc == "003787097" |
      ndc == "003787099" |
      ndc == "004094765" |
      ndc == "004094778" |
      ndc == "004097064" |
      ndc == "004800863" |
      ndc == "004800864" |
      ndc == "004800865" |
      ndc == "007030956" |
      ndc == "007030958" |
      ndc == "007030960" |
      ndc == "007030969" |
      ndc == "008598562" |
      ndc == "008598564" |
      ndc == "101300197" |
      ndc == "101300198" |
      ndc == "101300199" |
      ndc == "105440148" |
      ndc == "125278551" |
      ndc == "125278553" |
      ndc == "134110314" |
      ndc == "134110450" |
      ndc == "230708551" |
      ndc == "230708553" |
      ndc == "242360383" |
      ndc == "242360648" |
      ndc == "337340001" |
      ndc == "412840515" |
      ndc == "436830115" |
      ndc == "447950001" |
      ndc == "498561310" |
      ndc == "510790181" |
      ndc == "510790218" |
      ndc == "510790233" |
      ndc == "510790402" |
      ndc == "510790403" |
      ndc == "511292859" |
      ndc == "511294060" |
      ndc == "518467786" |
      ndc == "525550774" |
      ndc == "525550775" |
      ndc == "525550776" |
      ndc == "538080223" |
      ndc == "538080349" |
      ndc == "543480662" |
      ndc == "545695583" |
      ndc == "549070709" |
      ndc == "549070710" |
      ndc == "551544852" |
      ndc == "551546177" |
      ndc == "551546187" |
      ndc == "553900197" |
      ndc == "553900198" |
      ndc == "553900199" |
      ndc == "558870292" |
      ndc == "604290744" |
      ndc == "605051310" |
      ndc == "625405311" |
      ndc == "627780029" |
      ndc == "627780030" |
      ndc == "627780032" |
      ndc == "627780033" |
      ndc == "631260251" |
      ndc == "631260252" |
      ndc == "631260253" |
      ndc == "636291326" |
      ndc == "636291724" |
      ndc == "636293868" |
      ndc == "650150108" |
      ndc == "650150109" |
      ndc == "650150110" |
      ndc == "663360433" |
      ndc == "672280235" |
      ndc == "672280286" |
      ndc == "672960261" |
      ndc == "672960579" |
      ndc == "675440796" |
      ndc == "675440797" |
      ndc == "680710229" |
      ndc == "681150464" |
      ndc == "683870535" |
      ndc == "685330013" |
      ndc == "685330516" |
      ndc == "687880127" |
      ndc == "687889024" |
      ndc == "689500006" |
      ndc == "689500007" |
      ndc == "001791982" |
      ndc == "105440606" |
      ndc == "118190323" |
      ndc == "118190351" |
      ndc == "118190360" |
      ndc == "139130001" |
      ndc == "167140651" |
      ndc == "167140652" |
      ndc == "167140653" |
      ndc == "216950210" |
      ndc == "216950411" |
      ndc == "428520001" |
      ndc == "493490612" |
      ndc == "493490612" |
      ndc == "500900313" |
      ndc == "504190754" |
      ndc == "504190758" |
      ndc == "516720408" |
      ndc == "516720408" |
      ndc == "516720408" |
      ndc == "529590730" |
      ndc == "529590734" |
      ndc == "529590734" |
      ndc == "529590739" |
      ndc == "534010005" |
      ndc == "538080022" |
      ndc == "538080034" |
      ndc == "548680485" |
      ndc == "548680489" |
      ndc == "548680502" |
      ndc == "551110422" |
      ndc == "551110423" |
      ndc == "551540208" |
      ndc == "551540208" |
      ndc == "557000481" |
      ndc == "557000608" |
      ndc == "614420222" |
      ndc == "614420223" |
      ndc == "614420224" |
      ndc == "637390559" |
      ndc == "637390700" |
      ndc == "658620076" |
      ndc == "658620077" |
      ndc == "658620078" |
      ndc == "661160480" |
      ndc == "661160508" |
      ndc == "672960058" |
      ndc == "672960060" |
      ndc == "680840069" |
      ndc == "680840070" |
      ndc == "680840071" |
      ndc == "687880922" |
      ndc == "687880972" |
      ndc == "000654656" |
      ndc == "000851754" |
      ndc == "000851756" |
      ndc == "000851758" |
      ndc == "001791224" |
      ndc == "001791225" |
      ndc == "001791226" |
      ndc == "001791510" |
      ndc == "001822631" |
      ndc == "001822721" |
      ndc == "001822722" |
      ndc == "001850442" |
      ndc == "001850451" |
      ndc == "001850470" |
      ndc == "005271384" |
      ndc == "005271385" |
      ndc == "005271386" |
      ndc == "005550694" |
      ndc == "005550695" |
      ndc == "005550696" |
      ndc == "005550814" |
      ndc == "005550815" |
      ndc == "005550816" |
      ndc == "009045842" |
      ndc == "103700107" |
      ndc == "103700108" |
      ndc == "125278512" |
      ndc == "125278513" |
      ndc == "125278514" |
      ndc == "125378897" |
      ndc == "126340423" |
      ndc == "126340689" |
      ndc == "126340825" |
      ndc == "138631003" |
      ndc == "138631004" |
      ndc == "138631005" |
      ndc == "144450000" |
      ndc == "147890100" |
      ndc == "154560001" |
      ndc == "165900735" |
      ndc == "188370245" |
      ndc == "188370319" |
      ndc == "234901507" |
      ndc == "234905321" |
      ndc == "234905322" |
      ndc == "242080444" |
      ndc == "242360030" |
      ndc == "242360582" |
      ndc == "433530472" |
      ndc == "433530473" |
      ndc == "493490035" |
      ndc == "493490036" |
      ndc == "493490086" |
      ndc == "493490194" |
      ndc == "493490246" |
      ndc == "493490431" |
      ndc == "493490453" |
      ndc == "493490662" |
      ndc == "493490854" |
      ndc == "498561000" |
      ndc == "498561308" |
      ndc == "498561309" |
      ndc == "498840637" |
      ndc == "498840638" |
      ndc == "498840639" |
      ndc == "499990333" |
      ndc == "511292838" |
      ndc == "511292853" |
      ndc == "511292860" |
      ndc == "511292889" |
      ndc == "511293472" |
      ndc == "511293524" |
      ndc == "511294167" |
      ndc == "516550385" |
      ndc == "516724085" |
      ndc == "516724086" |
      ndc == "516724087" |
      ndc == "525494085" |
      ndc == "525494086" |
      ndc == "525494087" |
      ndc == "525550769" |
      ndc == "525550770" |
      ndc == "525550771" |
      ndc == "529590036" |
      ndc == "529590037" |
      ndc == "529590171" |
      ndc == "529590855" |
      ndc == "530020268" |
      ndc == "539783075" |
      ndc == "539783312" |
      ndc == "545691648" |
      ndc == "545691723" |
      ndc == "545692488" |
      ndc == "545693296" |
      ndc == "545694820" |
      ndc == "545695510" |
      ndc == "545695612" |
      ndc == "545695613" |
      ndc == "548680939" |
      ndc == "548680990" |
      ndc == "548681184" |
      ndc == "548682782" |
      ndc == "548684858" |
      ndc == "548684898" |
      ndc == "548685023" |
      ndc == "548685130" |
      ndc == "550451469" |
      ndc == "550451494" |
      ndc == "550452036" |
      ndc == "550452621" |
      ndc == "550453081" |
      ndc == "550453199" |
      ndc == "551542081" |
      ndc == "551544801" |
      ndc == "551544806" |
      ndc == "551544807" |
      ndc == "551545851" |
      ndc == "551545852" |
      ndc == "551545853" |
      ndc == "552890371" |
      ndc == "552890459" |
      ndc == "552890717" |
      ndc == "555670098" |
      ndc == "558870584" |
      ndc == "558870792" |
      ndc == "558870904" |
      ndc == "558870941" |
      ndc == "578666250" |
      ndc == "578666251" |
      ndc == "580160116" |
      ndc == "580160117" |
      ndc == "580160118" |
      ndc == "580160137" |
      ndc == "580160953" |
      ndc == "580160957" |
      ndc == "588640637" |
      ndc == "604290742" |
      ndc == "604290743" |
      ndc == "604910134" |
      ndc == "604910139" |
      ndc == "604910140" |
      ndc == "605051000" |
      ndc == "605051308" |
      ndc == "605051309" |
      ndc == "607600513" |
      ndc == "618070035" |
      ndc == "625840335" |
      ndc == "625840336" |
      ndc == "637390400" |
      ndc == "637390427" |
      ndc == "637751000" |
      ndc == "645790017" |
      ndc == "645790018" |
      ndc == "645790019" |
      ndc == "647250387" |
      ndc == "654130769" |
      ndc == "654130770" |
      ndc == "654130771" |
      ndc == "661050109" |
      ndc == "662670058" |
      ndc == "662670431" |
      ndc == "663360525" |
      ndc == "663360527" |
      ndc == "663360903" |
      ndc == "669840654" |
      ndc == "672280033" |
      ndc == "672280376" |
      ndc == "672280452" |
      ndc == "672960028" |
      ndc == "672960142" |
      ndc == "672960176" |
      ndc == "672960210" |
      ndc == "672960237" |
      ndc == "672960543" |
      ndc == "672960580" |
      ndc == "672960599" |
      ndc == "672960608" |
      ndc == "672960620" |
      ndc == "675440823" |
      ndc == "675440867" |
      ndc == "676680121" |
      ndc == "676680122" |
      ndc == "676680123" |
      ndc == "677670137" |
      ndc == "677670138" |
      ndc == "677670139" |
      ndc == "680710055" |
      ndc == "682589237" |
      ndc == "685330014" |
      ndc == "685330015" |
      ndc == "685330016" |
      ndc == "686450030" |
      ndc == "687880557" |
      ndc == "687881385" |
      ndc == "687889006" |
      ndc == "687889012" |
      ndc == "672960054" |
      ndc == "545695560" |
      ndc == "548684928" |
      ndc == "672960164" |
      ndc == "545694723" |
      ndc == "000851775" |
      ndc == "000851778" |
      ndc == "004407290" |
      ndc == "004407291" |
      ndc == "125278889" |
      ndc == "125278897" |
      ndc == "165900054" |
      ndc == "234900320" |
      ndc == "234905323" |
      ndc == "246580250" |
      ndc == "499990334" |
      ndc == "545695574" |
      ndc == "545695584" |
      ndc == "545695899" |
      ndc == "548684734" |
      ndc == "548685044" |
      ndc == "550453080" |
      ndc == "551546164" |
      ndc == "588640806" |
      ndc == "588640833" |
      ndc == "672280032" |
      ndc == "680710050" |
      ndc == "681150446" |
      ndc == "538080306" |
      ndc == "511294187" | 
      
      ## Ciprofloxacin PROCEDURES
      proc_cde == "J0744" |
      proc_cde == "J7342" ~ "ciprofloxacin", 
    
    ## METRONIDAZOLE
    ndc == "000251821" |
      ndc == "000251831" |
      ndc == "000251942" |
      ndc == "000692390" |
      ndc == "001439772" |
      ndc == "001791482" |
      ndc == "002645535" |
      ndc == "003381055" |
      ndc == "003389541" |
      ndc == "003389554" |
      ndc == "004097811" |
      ndc == "004097811" |
      ndc == "004401795" |
      ndc == "004401796" |
      ndc == "005912521" |
      ndc == "005915215" |
      ndc == "006151576" |
      ndc == "006151577" |
      ndc == "006157693" |
      ndc == "009041453" |
      ndc == "009046568" |
      ndc == "105440265" |
      ndc == "105440270" |
      ndc == "105440562" |
      ndc == "105440938" |
      ndc == "126340172" |
      ndc == "216950308" |
      ndc == "216950309" |
      ndc == "231550568" |
      ndc == "231550569" |
      ndc == "231550651" |
      ndc == "231550652" |
      ndc == "293000226" |
      ndc == "293000227" |
      ndc == "332610384" |
      ndc == "353560890" |
      ndc == "360000001" |
      ndc == "360000028" |
      ndc == "422920001" |
      ndc == "430630021" |
      ndc == "430630108" |
      ndc == "430630719" |
      ndc == "430630738" |
      ndc == "467080021" |
      ndc == "467080428" |
      ndc == "467080429" |
      ndc == "467080435" |
      ndc == "499990095" |
      ndc == "500900020" |
      ndc == "500900021" |
      ndc == "500900021" |
      ndc == "500900021" |
      ndc == "501110333" |
      ndc == "501110334" |
      ndc == "502680538" |
      ndc == "502680539" |
      ndc == "504360022" |
      ndc == "504360403" |
      ndc == "504360403" |
      ndc == "510790216" |
      ndc == "516550123" |
      ndc == "516550189" |
      ndc == "516550190" |
      ndc == "523430095" |
      ndc == "523430096" |
      ndc == "529590102" |
      ndc == "529590400" |
      ndc == "530020247" |
      ndc == "530020247" |
      ndc == "532170264" |
      ndc == "538080047" |
      ndc == "548680010" |
      ndc == "548680015" |
      ndc == "551540047" |
      ndc == "551540066" |
      ndc == "551540517" |
      ndc == "551540539" |
      ndc == "551540539" |
      ndc == "551540550" |
      ndc == "551540556" |
      ndc == "551540713" |
      ndc == "552890172" |
      ndc == "552890521" |
      ndc == "556950011" |
      ndc == "557000298" |
      ndc == "557000476" |
      ndc == "576640653" |
      ndc == "576640654" |
      ndc == "581180052" |
      ndc == "586570683" |
      ndc == "586570684" |
      ndc == "607600334" |
      ndc == "607600336" |
      ndc == "617860068" |
      ndc == "617860576" |
      ndc == "617860829" |
      ndc == "619190032" |
      ndc == "619190363" |
      ndc == "619190385" |
      ndc == "619190499" |
      ndc == "619190788" |
      ndc == "620320507" |
      ndc == "623320016" |
      ndc == "623320017" |
      ndc == "623320018" |
      ndc == "629800509" |
      ndc == "629800510" |
      ndc == "631870035" |
      ndc == "631870511" |
      ndc == "631870711" |
      ndc == "631870827" |
      ndc == "636290138" |
      ndc == "636290138" |
      ndc == "636290637" |
      ndc == "642050252" |
      ndc == "642050333" |
      ndc == "643800779" |
      ndc == "643800780" |
      ndc == "649800235" |
      ndc == "649800236" |
      ndc == "658620694" |
      ndc == "658620695" |
      ndc == "661160601" |
      ndc == "662670147" |
      ndc == "662670148" |
      ndc == "662670804" |
      ndc == "662670805" |
      ndc == "672960127" |
      ndc == "672960128" |
      ndc == "672960136" |
      ndc == "672960160" |
      ndc == "680010229" |
      ndc == "680010263" |
      ndc == "680710187" |
      ndc == "680710193" |
      ndc == "680710219" |
      ndc == "680710303" |
      ndc == "680840216" |
      ndc == "680840966" |
      ndc == "681510200" |
      ndc == "683820850" |
      ndc == "683820851" |
      ndc == "687880684" |
      ndc == "687880693" |
      ndc == "687880696" |
      ndc == "687880738" |
      ndc == "687880893" |
      ndc == "687880908" |
      ndc == "687880908" |
      ndc == "687880937" |
      ndc == "687880939" |
      ndc == "687880950" |
      ndc == "690430004" |
      ndc == "690430005" |
      ndc == "705180001" |
      ndc == "705180005" |
      ndc == "705180008" |
      ndc == "705180009" |
      ndc == "705180032" |
      ndc == "705180079" |
      ndc == "707710104" |
      ndc == "707710104" |
      ndc == "708820130" |
      ndc == "708820131" |
      ndc == "712090062" |
      ndc == "712090063" |
      ndc == "713350035" |
      ndc == "758340107" |
      ndc == "758340108" |
      ndc == "764130114" |
      ndc == "764130134" |
      ndc == "000251961" |
      ndc == "000690069" |
      ndc == "000747811" |
      ndc == "000930851" |
      ndc == "000930852" |
      ndc == "001722971" |
      ndc == "001723007" |
      ndc == "001790690" |
      ndc == "001791227" |
      ndc == "001791469" |
      ndc == "001821330" |
      ndc == "001821517" |
      ndc == "003381847" |
      ndc == "003383400" |
      ndc == "004407795" |
      ndc == "004407796" |
      ndc == "005912522" |
      ndc == "005913969" |
      ndc == "005913970" |
      ndc == "005915540" |
      ndc == "005915552" |
      ndc == "006034640" |
      ndc == "006034641" |
      ndc == "007817078" |
      ndc == "009042694" |
      ndc == "009051847" |
      ndc == "118190164" |
      ndc == "118190166" |
      ndc == "126340165" |
      ndc == "134110399" |
      ndc == "134110400" |
      ndc == "153380150" |
      ndc == "153380303" |
      ndc == "153380304" |
      ndc == "165900152" |
      ndc == "170220189" |
      ndc == "178560334" |
      ndc == "234900334" |
      ndc == "234905924" |
      ndc == "234905925" |
      ndc == "242360091" |
      ndc == "242360186" |
      ndc == "242360263" |
      ndc == "242360277" |
      ndc == "242360572" |
      ndc == "242360719" |
      ndc == "242360969" |
      ndc == "250210131" |
      ndc == "467030067" |
      ndc == "493490008" |
      ndc == "493490034" |
      ndc == "493490056" |
      ndc == "493490071" |
      ndc == "493490164" |
      ndc == "493490243" |
      ndc == "498840095" |
      ndc == "498840114" |
      ndc == "499990313" |
      ndc == "501110884" |
      ndc == "505960027" |
      ndc == "505960075" |
      ndc == "510790122" |
      ndc == "510790126" |
      ndc == "511291622" |
      ndc == "511291930" |
      ndc == "511291935" |
      ndc == "511292366" |
      ndc == "511292669" |
      ndc == "511293212" |
      ndc == "511293792" |
      ndc == "511293869" |
      ndc == "511293964" |
      ndc == "511294264" |
      ndc == "525550095" |
      ndc == "525550725" |
      ndc == "525550726" |
      ndc == "530020221" |
      ndc == "534890135" |
      ndc == "534890136" |
      ndc == "539780215" |
      ndc == "539783056" |
      ndc == "543480740" |
      ndc == "543480745" |
      ndc == "545690965" |
      ndc == "545690967" |
      ndc == "545693354" |
      ndc == "548683786" |
      ndc == "550451128" |
      ndc == "550451220" |
      ndc == "550453307" |
      ndc == "551545509" |
      ndc == "551545566" |
      ndc == "551545567" |
      ndc == "551546150" |
      ndc == "552881258" |
      ndc == "552881259" |
      ndc == "552881260" |
      ndc == "553700562" |
      ndc == "558870788" |
      ndc == "558870789" |
      ndc == "575750089" |
      ndc == "578664032" |
      ndc == "578664033" |
      ndc == "580120810" |
      ndc == "580160129" |
      ndc == "580160725" |
      ndc == "580870044" |
      ndc == "588640354" |
      ndc == "588640355" |
      ndc == "592140334" |
      ndc == "592146620" |
      ndc == "607600333" |
      ndc == "607600641" |
      ndc == "613920397" |
      ndc == "613920399" |
      ndc == "618070023" |
      ndc == "618070024" |
      ndc == "629911685" |
      ndc == "634860204" |
      ndc == "636291386" |
      ndc == "636291388" |
      ndc == "637390175" |
      ndc == "637390176" |
      ndc == "650240002" |
      ndc == "650590002" |
      ndc == "651620303" |
      ndc == "651620304" |
      ndc == "661160045" |
      ndc == "662670726" |
      ndc == "663360507" |
      ndc == "663360592" |
      ndc == "664664032" |
      ndc == "664664033" |
      ndc == "664674032" |
      ndc == "672280096" |
      ndc == "672960078" |
      ndc == "675440722" |
      ndc == "675440781" |
      ndc == "675440792" |
      ndc == "680710351" |
      ndc == "680710644" |
      ndc == "680710683" |
      ndc == "680840130" |
      ndc == "681150240" |
      ndc == "681150241" |
      ndc == "687880333" |
      ndc == "687880334" |
      ndc == "687880851" |
      ndc == "687880852" |
      ndc == "687889082" |
      ndc == "687889083" |
      ndc == "688840333" |
      ndc == "689093835" |
      ndc == "689500008" |
      ndc == "633700152" |
      ndc == "009051804" |
      ndc == "101300754" |
      ndc == "538080309" |
      
      ## Metronidazole PROCEDURES
      proc_cde == "S0030" ~ "metronidazole", 
    
    
    ############ Immune Modulators
    ## Methotrexate   
    ndc == "00364249901"|
      ndc == "00536399801"|
      ndc == "00781107601"|
      ndc == "38779003504"|
      ndc == "38779003506"|
      ndc == "49452460002"|
      ndc == "49452460102"|
      ndc == "49452460104"|
      ndc == "51552105401"|
      ndc == "51552105409"|
      ndc == "51927156500"|
      ndc == "62991120001"|
      ndc == "62991120002"|
      ndc == "62991120004"|
      ndc == "62991120005"|
      ndc == "63370015410"|
      ndc == "63370015415"|
      ndc == "63370015425"|
      ndc == "54436001002"|
      ndc == "54436001004"|
      ndc == "54436001502"|
      ndc == "54436001504"|
      ndc == "54436001704"|
      ndc == "54436002002"|
      ndc == "54436002004"|
      ndc == "54436002502"|
      ndc == "54436002504"|
      ndc == "54436007504"|
      ndc == "59137050504"|
      ndc == "59137051004"|
      ndc == "59137051504"|
      ndc == "59137052004"|
      ndc == "59137052504"|
      ndc == "59137053004"|
      ndc == "59137053504"|
      ndc == "59137054004"|
      ndc == "59137054504"|
      ndc == "59137055004"|
      ndc == "00005450723"|
      ndc == "00054455015"|
      ndc == "00054455025"|
      ndc == "00054855025"|
      ndc == "00069014601"|
      ndc == "00069014602"|
      ndc == "00069014701"|
      ndc == "00069014702"|
      ndc == "00069014801"|
      ndc == "00069014901"|
      ndc == "00069018102"|
      ndc == "00069020410"|
      ndc == "00186142013"|
      ndc == "00205532526"|
      ndc == "00378001401"|
      ndc == "00378001450"|
      ndc == "00555057202"|
      ndc == "00555057235"|
      ndc == "00555092701"|
      ndc == "00555092801"|
      ndc == "00555092901"|
      ndc == "00555094501"|
      ndc == "00703367101"|
      ndc == "00703367103"|
      ndc == "00703367191"|
      ndc == "00703367193"|
      ndc == "00703367301"|
      ndc == "00703367501"|
      ndc == "00703367591"|
      ndc == "00703367801"|
      ndc == "00904174960"|
      ndc == "00904601260"|
      ndc == "10019094101"|
      ndc == "10139006202"|
      ndc == "10139006210"|
      ndc == "10139006240"|
      ndc == "16729027703"|
      ndc == "16729027730"|
      ndc == "16729027735"|
      ndc == "21695011100"|
      ndc == "23490588900"|
      ndc == "42254011030"|
      ndc == "42291059401"|
      ndc == "49999038024"|
      ndc == "51079067001"|
      ndc == "51079067005"|
      ndc == "51285036601"|
      ndc == "51285036701"|
      ndc == "51285036801"|
      ndc == "51285036901"|
      ndc == "51285050902"|
      ndc == "52959024400"|
      ndc == "54868017300"|
      ndc == "54868017301"|
      ndc == "54868382600"|
      ndc == "54868382601"|
      ndc == "54868382602"|
      ndc == "54868382604"|
      ndc == "54868382605"|
      ndc == "54868382606"|
      ndc == "54868382607"|
      ndc == "54868471600"|
      ndc == "54868479600"|
      ndc == "55289092430"|
      ndc == "55390003110"|
      ndc == "55390003210"|
      ndc == "55390003310"|
      ndc == "55390003410"|
      ndc == "55390014301"|
      ndc == "58406067105"|
      ndc == "58406068114"|
      ndc == "58406068117"|
      ndc == "58406068316"|
      ndc == "59911587401"|
      ndc == "60429008036"|
      ndc == "61703035010"|
      ndc == "61703035038"|
      ndc == "61703040807"|
      ndc == "61703040841"|
      ndc == "63323012102"|
      ndc == "63323012104"|
      ndc == "63323012108"|
      ndc == "63323012110"|
      ndc == "63323012140"|
      ndc == "63323012250"|
      ndc == "63323012302"|
      ndc == "63323012310"|
      ndc == "66479013501"|
      ndc == "66479013509"|
      ndc == "66479013611"|
      ndc == "66479013613"|
      ndc == "66479013619"|
      ndc == "66479013721"|
      ndc == "66479013929"|
      ndc == "66758004001"|
      ndc == "66758004002"|
      ndc == "66758004008"|
      ndc == "66758004101"|
      ndc == "67253032010"|
      ndc == "67253032036"|
      ndc == "67457022102"|
      ndc == "67457022110"|
      ndc == "67457022140"|
      ndc == "67457046610"|
      ndc == "67457046721"|
      ndc == "67457046799"|
      ndc == "67457048040"|
      ndc == "67457048599"|
      ndc == "67457048699"|
      ndc == "68115063200"|
      ndc == "00005450704"|
      ndc == "00005450705"|
      ndc == "00005450791"|
      ndc == "00054855003"|
      ndc == "00054855005"|
      ndc == "00054855006"|
      ndc == "00054855007"|
      ndc == "00054855010"|
      ndc == "00555057245"|
      ndc == "00555057246"|
      ndc == "00555057247"|
      ndc == "00555057248"|
      ndc == "00555057249"|
      ndc == "67253058042"|
      ndc == "67253058043"|
      ndc == "67253058044"|
      ndc == "67253058045"|
      ndc == "67253058046"| 
      
      ## Methotrexate PROCEDURE 
      proc_cde == "J8610"|
      proc_cde == "J9250"|
      proc_cde == "J9260" ~ "methotrexate", 
    
    
    ## Mercaptopurine
    ndc =="00054458111" |
      ndc =="00054458127" |
      ndc =="00093551006" |
      ndc =="00173080725" |
      ndc =="00378354725" |
      ndc =="00378354752" |
      ndc =="49884092202" |
      ndc =="49884092204" |
      ndc =="54868528200" |
      ndc =="57844052206" |
      ndc =="57844052207" |
      ndc =="62484002001" |
      ndc =="68084032511" |
      ndc =="68084032521" |
      ndc =="68258910301" ~ "mercaptopurine", 
    
    ## Azathioprine
    ndc == "00054408425"|
      ndc == "00054808425" |
      ndc == "00173059755"|
      ndc == "00378100501" |
      ndc == "00406200301"|
      ndc == "00781507501" |
      ndc == "23490511009"|
      ndc == "38779031203" |
      ndc == "38779031204"|
      ndc == "38779031206" |
      ndc == "43353068609"|
      ndc == "43353068660" |
      ndc == "43353074509"|
      ndc == "43353074560" |
      ndc == "49452078301"|
      ndc == "49452078302" |
      ndc == "51079062001"|
      ndc == "51079062006" |
      ndc == "51552077902"|
      ndc == "51552077905" |
      ndc == "51927225800"|
      ndc == "52959007900" |
      ndc == "54868092101"|
      ndc == "54868092104" |
      ndc == "54868531000"|
      ndc == "54868531003" |
      ndc == "54868531004"|
      ndc == "57866902101" |
      ndc == "60976059755"|
      ndc == "62991218901" |
      ndc == "62991218903"|
      ndc == "63370002510" |
      ndc == "65483059010"|
      ndc == "65649023141" |
      ndc == "65649024141"|
      ndc == "66479030110" |
      ndc == "66591022141"|
      ndc == "66591023141" |
      ndc == "66591024141"|
      ndc == "68084022901" |
      ndc == "68084022911"|
      ndc == "68382000301" |
      ndc == "68382000305"|
      ndc == "68462050201" |
      ndc == "69238107601"|
      ndc == "55390060020" |
      
      
      ## Azathioprine PROCEDURE
      proc_cde == "J7500" |
      proc_cde == "J7501" ~ "azathioprine", 
    
    
    ############## Anti-TNF Agents
    ## ADALIMUMAB
    ndc == "00074379902"|
      ndc == "00074379903" |
      ndc == "00074379906"|
      ndc == "00074433902" |
      ndc == "00074433906"|
      ndc == "00074433907" |
      ndc == "00074634702"|
      ndc == "00074937402" |
      ndc == "54868482200"|
      
      ## Adalimumab PROCEDURE
      proc_cde == "J0135" ~ "adalimumab", 
    
    ## CERTOLIZUMAB_PEGOL
    ndc == "50474070062"|
      ndc == "50474071079" |
      ndc == "50474071081"|
      
      ## CERTOLIZUMAB_PEGOL PROCEDURES
      proc_cde == "J0717"|
      proc_cde == "J0718" |
      proc_cde == "C9249" ~"certolizumab_pegol", 
    
    ## Golimumab
    ndc == "57894007001" |
      ndc == "57894007002" |
      ndc == "57894007101" |
      ndc == "57894007102" |
      ndc == "57894035001" |
      
      ## Golimumab PROCEDURE
      proc_cde == "J1602" ~ "golimumab", 
    
    ## Infliximab
    ndc == "57894003001" |
      
      ## infliximab PROCEDURES
      proc_cde == "J1745" |
      proc_cde == "Q5102" |
      proc_cde == "Q5102"  ~ "infliximab", 
    
    #################### Anti-Integrin Agents
    
    ## NATALIZUMAB
    ndc == "59075073015"|
      ndc == "64406000801"|
      
      ## Natalizumab PROCEDURES
      proc_cde == "J2323" ~ "natalizumab", 
    
    ## VEDOLIZUMAB
    ndc == "64764030020" |
      
      ## vedolizumab PROCEDURES 
      proc_cde == "J3380" |
      proc_cde == "C9026" ~ "vedolizumab", 
    
    #################### Anti-IL*-12/23 (interleukin)
    ## Ustekinumab
    ndc == "57894005427" |
      ndc == "57894006003" |
      ndc == "57894006103" |
      ndc == "57894006102" |
      ndc == "57894006002" |
      
      ## Ustekinumab PROCEDURES
      proc_cde == "C9261" |
      proc_cde == "J3357" |
      proc_cde == "Q9989" |
      proc_cde == "C9487" |
      proc_cde == "J3358"  ~ "ustekinumab", 
    
    #################### Steroid
    ## Budesonide
    ndc == "00093744501"|
      ndc == "00186070210"|
      ndc == "00378715501"|
      ndc == "00378715505"|
      ndc == "49884050101"|
      ndc == "51079002001"|
      ndc == "51079002003"|
      ndc == "54868491000"|
      ndc == "54868491001"|
      ndc == "54868491002"|
      ndc == "60429026401"|
      ndc == "65483070210"|
      ndc == "68012030930" ~ "budesonide"))


### create new column for specific drug class
cohort$drug_class <- 0

cohort <- cohort %>%
  mutate(drug_class = case_when(
    
    ############### Aminosalicylates
    drug_name == "sulfasalazine" |
      drug_name == "mesalamine" |
      drug_name == "balsalazide_disodium" |
      drug_name == "olsalazine_sodium" ~"aminosalicylates", 
    
    ############### Antibiotics
    drug_name == "ciprofloxacin" |
      drug_name == "metronidazole" ~ "antibiotics", 
    
    ############### Immune modulators
    drug_name == "methotrexate" |
      drug_name == "mercaptopurine" |
      drug_name == "azathioprine" ~ "immune_modulator",
    
    ############### Anti-TNF Agents
    drug_name == "adalimumab" |
      drug_name == "certolizumab_pegol" |
      drug_name == "golimumab" |
      drug_name == "infliximab" ~ "anti_TNF_agent", 
    
    ############### Anti-Integrin Agents
    drug_name == "natalizumab" |
      drug_name == "vedolizumab" ~ "anti_integrin_agent",
    
    ###############  Anti-IL*-12/23 (interleukin)
    drug_name == "ustekinumab" ~"anti_IL", 
    
    ############### Steroid:
    drug_name == "budesonide" ~ "steroid" ))


### Create a new column to identify diagnosis

cohort$diagnosis <- ifelse(grepl("(\\b556)|(\\bK51)", cohort$diag1),"ulcerative_colitis",
                             ifelse(grepl("(\\b555)|(\\bK50)", cohort$diag1), "crohns", NA))

## for BLANK values in conf_num, introduce NA instead
cohort$conf_num <- as.character(cohort$conf_num)
cohort$conf_num[cohort$conf_num == ""] <- NA


#Output as RDS file for upload
#saveRDS(cohort, "cohort.rds")
